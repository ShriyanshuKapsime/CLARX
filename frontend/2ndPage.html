<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClearBuy | Full Analysis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "Frutiger";
        src: url("https://fonts.cdnfonts.com/s/59217/FrutigerLTStd-Bold.woff") format("woff");
        font-weight: 600 800;
        font-style: normal;
      }

      :root {
        --background: #e8edf7;
        --surface: rgba(255, 255, 255, 0.78);
        --surface-soft: rgba(255, 255, 255, 0.65);
        --border: rgba(255, 255, 255, 0.6);
        --text-primary: #0f172a;
        --text-muted: #6b7280;
        --accent: #2563eb;
        --accent-muted: rgba(37, 99, 235, 0.14);
        --shadow: 0 25px 70px rgba(15, 23, 42, 0.12);
        --radius: 24px;
        --risk-color: #facc15;
        --risk-bg: rgba(250, 204, 21, 0.18);
        --risk-chart-bg: rgba(250, 204, 21, 0.12);
        --grade-bg: linear-gradient(145deg, rgba(254,249,195,0.95), rgba(253,224,71,0.85), rgba(250,204,21,0.75));
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--background);
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
      }

      b,
      strong,
      h1,
      h2,
      h3,
      h4 {
        font-family: "Frutiger", "Inter", sans-serif;
        font-weight: 600;
      }

      header {
        padding: 28px clamp(20px, 6vw, 64px) 0;
      }

      .nav {
        width: min(1120px, 100%);
        margin: 0 auto 44px;
        display: flex;
        align-items: center;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        font-size: 1.05rem;
      }

      .brand-icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background: var(--accent);
        display: grid;
        place-items: center;
        color: white;
        font-weight: 600;
        box-shadow: 0 10px 20px rgba(37, 99, 235, 0.35);
      }

      .hero {
        width: min(1100px, 100%);
        margin: 0 auto;
        text-align: left;
        padding-bottom: 32px;
      }

      .hero h1 {
        font-size: clamp(2.3rem, 5vw, 3.6rem);
        margin-bottom: 18px;
        line-height: 1.1;
      }

      .hero h1 span {
        color: var(--accent);
      }

      .hero p {
        max-width: 720px;
        color: var(--text-muted);
        font-size: 1.04rem;
        margin: 0;
      }

      .page {
        width: min(1120px, 100%);
        margin: 0 auto;
        padding: 0 clamp(20px, 6vw, 64px) 64px;
      }

      .card {
        background: var(--surface);
        border-radius: var(--radius);
        padding: clamp(24px, 4vw, 40px);
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        margin-bottom: 28px;
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        transition: transform 220ms ease, box-shadow 220ms ease;
      }

      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 30px 70px rgba(15, 23, 42, 0.12);
      }

      .section-header h2 {
        margin: 0;
        font-size: 1.4rem;
      }

      .section-header p {
        margin: 6px 0 0;
        color: var(--text-muted);
      }

      .trust-card {
        display: flex;
        flex-wrap: wrap;
        gap: clamp(24px, 5vw, 60px);
        align-items: flex-start;
        background: linear-gradient(120deg, rgba(255, 255, 255, 0.85), rgba(231, 239, 255, 0.65));
      }

      .trust-grade {
        width: clamp(200px, 32vw, 260px);
        aspect-ratio: 1;
        border-radius: 32px;
        background: var(--grade-bg);
        border: 1px solid var(--border);
        display: grid;
        place-items: center;
        text-align: center;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45);
      }

      .trust-grade span {
        font-size: clamp(90px, 16vw, 140px);
        font-family: "Frutiger", "Inter", sans-serif;
        font-weight: 600;
      }

      .trust-copy {
        flex: 1;
        min-width: 260px;
      }

      .trust-copy h2 {
        font-size: 1.9rem;
        margin: 0 0 14px;
      }

      .trust-copy p {
        margin-top: 0;
      }

      .risk-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px;
        border-radius: 999px;
        font-size: 0.95rem;
        background: var(--risk-bg);
        font-family: "Frutiger", "Inter", sans-serif;
        color: #0f172a;
        font-weight: 600;
      }

      .risk-pill .risk-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--risk-color);
      }

      .risk-pill .risk-label {
        font-weight: 600;
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-top: 24px;
      }

      .pattern-card {
        padding: 22px;
        border: 1px solid var(--border);
        border-radius: 20px;
        background: var(--surface-soft);
        box-shadow: inset 0 0 0 1px rgba(37, 99, 235, 0.04), 0 25px 45px rgba(15, 23, 42, 0.12);
        transition: transform 200ms ease, box-shadow 200ms ease;
      }

      .pattern-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 35px rgba(15, 23, 42, 0.15);
      }

      .pattern-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .severity {
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 600;
      }

      .severity.high {
        background: rgba(239, 68, 68, 0.12);
        color: #b91c1c;
      }

      .severity.medium {
        background: rgba(251, 191, 36, 0.18);
        color: #b45309;
      }

      .severity.low {
        background: rgba(34, 197, 94, 0.18);
        color: #15803d;
      }

      .pattern-card p {
        color: var(--text-muted);
        margin: 4px 0 0;
        line-height: 1.5;
      }

      .pattern-card strong {
        display: block;
        margin-top: 12px;
      }

      .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 16px;
        margin: 24px 0 32px;
      }

      .stat {
        padding: 18px;
        border-radius: 18px;
        background: var(--surface-soft);
        border: 1px solid var(--border);
        backdrop-filter: blur(16px);
      }

      .price-card .stat {
        transition: transform 200ms ease, box-shadow 200ms ease;
      }

      .price-card .stat:hover {
        transform: translateY(-4px);
        box-shadow: 0 15px 35px rgba(15, 23, 42, 0.15);
      }

      .stat-label {
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-size: 0.8rem;
      }

      .stat-value {
        font-size: 1.5rem;
        margin-top: 8px;
        font-family: "Frutiger", "Inter", sans-serif;
        color: var(--risk-color);
      }

      .price-card .stat-value,
      .mrp-card .stat-value {
        color: #0f172a;
      }

      .indicator {
        margin-top: 6px;
        font-weight: 600;
        color: #16a34a;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .indicator.down {
        color: #dc2626;
      }

      .chart-wrapper {
        width: 100%;
        height: 280px;
      }

      .mrp-callout {
        margin-top: 18px;
        padding: 18px 20px;
        border-radius: 16px;
        background: rgba(248, 113, 113, 0.12);
        color: #b91c1c;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .mrp-callout span {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ef4444;
      }

      .timer-status {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        margin: 16px 0 20px;
      }

      .status-pill {
        padding: 10px 20px;
        border-radius: 999px;
        font-weight: 600;
        background: rgba(239, 68, 68, 0.12);
        color: #dc2626;
      }

      .confidence-pill {
        padding: 8px 16px;
        border-radius: 999px;
        font-weight: 600;
        background: rgba(59, 130, 246, 0.15);
        color: #1d4ed8;
      }

      .confidence-pill.high {
        background: rgba(239, 68, 68, 0.15);
        color: #b91c1c;
      }

      .reason-panel {
        margin-top: 8px;
        padding: 22px;
        border-radius: 22px;
        background: linear-gradient(130deg, rgba(255, 255, 255, 0.86), rgba(246, 249, 255, 0.9));
        box-shadow: 0 30px 60px rgba(15, 23, 42, 0.12);
        border: 1px solid rgba(255, 255, 255, 0.7);
      }

      .reason-list {
        margin: 0;
        padding: 0;
        list-style: none;
        display: grid;
        gap: 12px;
      }

      .reason-list li {
        padding: 14px 18px;
        border-radius: 16px;
        background: rgba(248, 250, 255, 0.95);
        border: 1px solid rgba(226, 232, 240, 0.9);
        font-weight: 500;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: var(--accent);
        font-weight: 600;
        margin-top: 12px;
      }

      @media (max-width: 720px) {
        .nav {
          flex-direction: column;
          gap: 18px;
        }

        .hero {
          text-align: left;
        }

        .trust-card {
          text-align: left;
        }

        .trust-grade {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="nav">
        <div class="brand">
          <div class="brand-icon">CB</div>
          ClearBuy
        </div>
      </div>
      <div class="hero">
        <h1>
          Shop Smarter. Spot Manipulation. <br />
          <span>Buy with Confidence.</span>
        </h1>
        <p>
          Paste any product link from Flipkart, Amazon, Myntra, etc. and we'll analyze it for dark patterns,
          fake discounts, true MRP, and price history. Here’s your complete deep dive.
        </p>
      </div>
    </header>

    <main class="page">
      <section class="card trust-card" id="trustScoreCard">
        <div class="trust-grade">
          <span id="trustGrade">B</span>
        </div>
        <div class="trust-copy">
          <h2>Trust Score</h2>
          <p>
            Our analyzers blend manipulation likelihood, pricing integrity, and transparency signals to
            generate this grade. Scores update instantly when you paste any new product URL into
            FairBuy / ClearCart / TruthLens.
          </p>
          <div class="risk-pill">
            <span class="risk-dot"></span>
            <span class="risk-label">Moderate Risk</span>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="section-header">
          <h2>Dark Pattern Violation Summary</h2>
          <p>A clean rollup of the worst nudges, extracted directly from the product detail page.</p>
        </div>
        <div class="card-grid" id="darkPatternGrid">
          <article class="pattern-card">
            <div class="pattern-header">
              <h3>Fake Scarcity</h3>
              <span class="severity high">High</span>
            </div>
            <p>Countdown resets on every refresh with identical “04 left” inventory text.</p>
            <strong>Confidence: High</strong>
          </article>

          <article class="pattern-card">
            <div class="pattern-header">
              <h3>Drip Pricing</h3>
              <span class="severity medium">Medium</span>
            </div>
            <p>An extra handling fee appears only after address confirmation.</p>
            <strong>Confidence: Medium</strong>
          </article>

          <article class="pattern-card">
            <div class="pattern-header">
              <h3>Fake Timer</h3>
              <span class="severity high">High</span>
            </div>
            <p>Timer script is purely client-side and restarts per session.</p>
            <strong>Confidence: High</strong>
          </article>

          <article class="pattern-card">
            <div class="pattern-header">
              <h3>Pre-Ticked Add-On</h3>
              <span class="severity low">Low</span>
            </div>
            <p>Extended warranty checkbox is enabled by default.</p>
            <strong>Confidence: Low</strong>
          </article>
        </div>
      </section>

      <section class="card price-card">
        <div class="section-header">
          <h2>Price Tracker</h2>
          <p>We compare live prices to historic peaks, dips, and weekly averages.</p>
        </div>
        <div class="stat-grid">
          <div class="stat">
            <div class="stat-label">Current Price</div>
            <div class="stat-value">₹18,499</div>
            <div class="indicator down">↓ 6.4% vs last week</div>
          </div>
          <div class="stat">
            <div class="stat-label">Highest Price</div>
            <div class="stat-value">₹21,999</div>
            <div class="indicator">↑ 12.8% from baseline</div>
          </div>
          <div class="stat">
            <div class="stat-label">Lowest Price</div>
            <div class="stat-value">₹17,299</div>
            <div class="indicator">3 drops detected</div>
          </div>
          <div class="stat">
            <div class="stat-label">Trend Window</div>
            <div class="stat-value">7 days</div>
            <div class="indicator">Live refresh</div>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas id="priceChart"></canvas>
        </div>
      </section>

      <section class="card mrp-card">
        <div class="section-header">
          <h2>Real MRP Checker</h2>
          <p>We benchmark the site’s MRP with trusted catalogs to surface inflation.</p>
        </div>
        <div class="stat-grid">
          <div class="stat">
            <div class="stat-label">Website MRP</div>
            <div class="stat-value">₹24,999</div>
            <p>Captured 7:42 PM IST</p>
          </div>
          <div class="stat">
            <div class="stat-label">Fair MRP (Median)</div>
            <div class="stat-value">₹21,200</div>
            <p>Across 9 sellers</p>
          </div>
          <div class="stat">
            <div class="stat-label">Inflation</div>
            <div class="stat-value">+17.9%</div>
            <p>5% tolerance exceeded</p>
          </div>
        </div>
        <div class="mrp-callout">
          <span></span>
          Possible MRP inflation detected — negotiate or wait for the next price drop.
        </div>
      </section>

      <section class="card">
        <div class="section-header">
          <h2>Timer Manipulation Detection</h2>
          <p>Replay data from our headless browsers validates whether the urgency is real.</p>
        </div>
        <div class="timer-status">
          <div class="status-pill">Timer status: Suspicious</div>
          <span class="confidence-pill high">Confidence: High</span>
        </div>
        <div class="reason-panel">
          <ul class="reason-list">
            <li>Countdown resets on every reload within the same session.</li>
            <li>No server-side timestamp — logic is entirely client scripted.</li>
            <li>Offer expiry identical for all regions and IP clusters.</li>
          </ul>
        </div>
      </section>

      <a class="back-link" href="index.html">← Back to homepage</a>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
      const rootStyles = getComputedStyle(document.documentElement);
      const initialRiskColor = rootStyles.getPropertyValue("--risk-color").trim() || "#facc15";
      const initialRiskChartBg = rootStyles.getPropertyValue("--risk-chart-bg").trim() || "rgba(250,204,21,0.12)";
      const initialRiskPillBg = rootStyles.getPropertyValue("--risk-bg").trim() || "rgba(250,204,21,0.2)";
      const initialGradeBg =
        rootStyles.getPropertyValue("--grade-bg").trim() ||
        "linear-gradient(145deg, rgba(255,255,255,0.9), rgba(237,245,255,0.7))";

      const ctx = document.getElementById("priceChart");
      const priceChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
          datasets: [
            {
              data: [18999, 19299, 21899, 20999, 19399, 18499, 18799],
              borderColor: initialRiskColor,
              backgroundColor: initialRiskChartBg,
              fill: true,
              tension: 0.4,
              pointRadius: 0,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: "#0f172a",
              borderColor: "rgba(255, 255, 255, 0.08)",
              borderWidth: 1,
              padding: 10,
            },
          },
          scales: {
            x: {
              ticks: { color: "#94a3b8" },
              grid: { color: "rgba(148, 163, 184, 0.2)", borderDash: [4, 4] },
            },
            y: {
              ticks: {
                color: "#94a3b8",
                callback: (value) => `₹${value.toLocaleString("en-IN")}`,
              },
              grid: { color: "rgba(148, 163, 184, 0.2)", borderDash: [4, 4] },
            },
          },
        },
      });

      function setTrustGrade(grade) {
        const card = document.getElementById("trustScoreCard");
        const gradeEl = document.getElementById("trustGrade");
        const pill = card.querySelector(".risk-pill");

        gradeEl.textContent = grade.toUpperCase();
        card.dataset.grade = grade.toUpperCase();

        const config = {
          A: {
            color: "#16a34a",
            pillBg: "rgba(34,197,94,0.18)",
            label: "Low Risk",
            chartBg: "rgba(34,197,94,0.12)",
            gradeBg: "linear-gradient(145deg, rgba(220,252,231,0.95), rgba(134,239,172,0.85), rgba(74,222,128,0.75))",
          },
          B: {
            color: "#facc15",
            pillBg: "rgba(250,204,21,0.2)",
            label: "Moderate Risk",
            chartBg: "rgba(250,204,21,0.12)",
            gradeBg: "linear-gradient(145deg, rgba(254,249,195,0.95), rgba(253,224,71,0.85), rgba(250,204,21,0.75))",
          },
          C: {
            color: "#ef4444",
            pillBg: "rgba(239,68,68,0.22)",
            label: "High Manipulation Detected",
            chartBg: "rgba(239,68,68,0.14)",
            gradeBg: "linear-gradient(145deg, rgba(254,226,226,0.95), rgba(252,165,165,0.85), rgba(248,113,113,0.75))",
          },
          D: {
            color: "#f97316",
            pillBg: "rgba(249,115,22,0.2)",
            label: "High Manipulation Detected",
            chartBg: "rgba(249,115,22,0.12)",
            gradeBg: "linear-gradient(140deg, rgba(255,240,230,0.95), rgba(253,186,116,0.75))",
          },
          F: {
            color: "#ef4444",
            pillBg: "rgba(239,68,68,0.22)",
            label: "Critical Manipulation",
            chartBg: "rgba(239,68,68,0.18)",
            gradeBg: "linear-gradient(140deg, rgba(255,235,235,0.95), rgba(248,113,113,0.8))",
          },
        }[grade.toUpperCase()] || {
          color: initialRiskColor,
          pillBg: initialRiskPillBg,
          label: "Moderate Risk",
          chartBg: initialRiskChartBg,
          gradeBg: initialGradeBg,
        };

        document.documentElement.style.setProperty("--risk-color", config.color);
        document.documentElement.style.setProperty("--risk-bg", config.pillBg);
        document.documentElement.style.setProperty("--risk-chart-bg", config.chartBg);
        document.documentElement.style.setProperty("--grade-bg", config.gradeBg);

        pill.style.color = "#0f172a";
        pill.style.background = config.pillBg;
        pill.querySelector(".risk-dot").style.background = config.color;
        pill.querySelector(".risk-label").textContent = config.label;

        priceChart.data.datasets[0].borderColor = config.color;
        priceChart.data.datasets[0].backgroundColor = config.chartBg;
        priceChart.update();
      }

      // Initialize with B grade on page load
      setTrustGrade('B');

      // Backend API integration
      // Auto-detect API URL based on current host
      const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:5000'
        : `${window.location.protocol}//${window.location.host}`;

      // Check if URL parameter is present
      const urlParams = new URLSearchParams(window.location.search);
      const productUrl = urlParams.get('url');

      if (productUrl) {
        analyzeProduct(productUrl);
      }

      async function analyzeProduct(url) {
        // Show loading state
        showLoading();

        try {
          const response = await fetch(`${API_BASE_URL}/analyze`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ url: url }),
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || 'Analysis failed');
          }

          // Update UI with results
          updateUI(data);
        } catch (error) {
          console.error('Error:', error);
          showError(error.message);
        }
      }

      function showLoading() {
        const gradeEl = document.getElementById('trustGrade');
        if (gradeEl) {
          gradeEl.textContent = '...';
        }
        const riskLabel = document.querySelector('.risk-label');
        if (riskLabel) {
          riskLabel.textContent = 'Analyzing...';
        }
      }

      function showError(message) {
        const gradeEl = document.getElementById('trustGrade');
        if (gradeEl) {
          gradeEl.textContent = '?';
        }
        const riskLabel = document.querySelector('.risk-label');
        if (riskLabel) {
          riskLabel.textContent = 'Analysis failed: ' + message;
        }
        alert('Analysis failed: ' + message);
      }

      function updateUI(result) {
        // Update trust grade
        setTrustGrade(result.trust_grade);

        // Update risk label
        const riskLabel = document.querySelector('.risk-label');
        if (riskLabel) {
          riskLabel.textContent = result.trust_summary;
        }

        // Update dark pattern violations
        updateViolations(result.violations);

        // Update price stats
        updatePriceStats(result.price);

        // Update price chart
        updatePriceChart(result.price);

        // Update MRP stats
        updateMRPStats(result.mrp);

        // Update timer analysis
        updateTimerAnalysis(result.timer_analysis);
      }

      function updateViolations(violations) {
        const grid = document.getElementById('darkPatternGrid');
        if (!grid) return;

        grid.innerHTML = '';

        if (!violations || violations.length === 0) {
          grid.innerHTML = '<p style="color: var(--text-muted);">No dark patterns detected.</p>';
          return;
        }

        violations.forEach(violation => {
          const card = document.createElement('article');
          card.className = 'pattern-card';

          const severityClass = violation.severity || 'medium';
          const severityText = (violation.severity || 'medium').charAt(0).toUpperCase() + 
                              (violation.severity || 'medium').slice(1);

          card.innerHTML = `
            <div class="pattern-header">
              <h3>${violation.title || violation.type}</h3>
              <span class="severity ${severityClass}">${severityText}</span>
            </div>
            <p>${violation.explanation || ''}</p>
            <strong>Confidence: ${(violation.confidence || 'medium').charAt(0).toUpperCase() + 
                                  (violation.confidence || 'medium').slice(1)}</strong>
          `;

          grid.appendChild(card);
        });
      }

      function updatePriceStats(priceData) {
        const stats = document.querySelectorAll('.price-card .stat');
        if (!stats || stats.length < 4) return;

        // Current Price
        if (stats[0]) {
          const valueEl = stats[0].querySelector('.stat-value');
          if (valueEl && priceData.current) {
            valueEl.textContent = `₹${priceData.current.toLocaleString('en-IN')}`;
          }
        }

        // Highest Price
        if (stats[1]) {
          const valueEl = stats[1].querySelector('.stat-value');
          if (valueEl && priceData.highest) {
            valueEl.textContent = `₹${priceData.highest.toLocaleString('en-IN')}`;
          }
        }

        // Lowest Price
        if (stats[2]) {
          const valueEl = stats[2].querySelector('.stat-value');
          if (valueEl && priceData.lowest) {
            valueEl.textContent = `₹${priceData.lowest.toLocaleString('en-IN')}`;
          }
        }

        // Trend Window
        if (stats[3]) {
          const valueEl = stats[3].querySelector('.stat-value');
          if (valueEl && priceData.trend_window) {
            valueEl.textContent = priceData.trend_window;
          }
        }
      }

      function updatePriceChart(priceData) {
        if (!priceData.history || priceData.history.length === 0) return;

        // Format labels (extract day from timestamp)
        const labels = priceData.history.map(item => {
          const date = new Date(item.ts);
          const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          return days[date.getDay()] || date.toLocaleDateString('en-IN', { month: 'short', day: 'numeric' });
        });

        const prices = priceData.history.map(item => item.price);

        priceChart.data.labels = labels;
        priceChart.data.datasets[0].data = prices;
        priceChart.update();
      }

      function updateMRPStats(mrpData) {
        const stats = document.querySelectorAll('.mrp-card .stat');
        if (!stats || stats.length < 3) return;

        // Website MRP
        if (stats[0]) {
          const valueEl = stats[0].querySelector('.stat-value');
          if (valueEl && mrpData.site_mrp) {
            valueEl.textContent = `₹${mrpData.site_mrp.toLocaleString('en-IN')}`;
          }
        }

        // Fair MRP
        if (stats[1]) {
          const valueEl = stats[1].querySelector('.stat-value');
          if (valueEl && mrpData.fair_mrp) {
            valueEl.textContent = `₹${mrpData.fair_mrp.toLocaleString('en-IN')}`;
          }
        }

        // Inflation
        if (stats[2]) {
          const valueEl = stats[2].querySelector('.stat-value');
          if (valueEl && mrpData.inflation_pct !== undefined) {
            const sign = mrpData.inflation_pct > 0 ? '+' : '';
            valueEl.textContent = `${sign}${mrpData.inflation_pct.toFixed(1)}%`;
          }
        }
      }

      function updateTimerAnalysis(timerData) {
        if (!timerData) return;

        const statusPill = document.querySelector('.status-pill');
        const confidencePill = document.querySelector('.confidence-pill');
        const reasonList = document.querySelector('.reason-list');

        // Update status
        if (statusPill) {
          if (timerData.fake_timer) {
            statusPill.textContent = 'Timer status: Suspicious';
            statusPill.className = 'status-pill alert';
          } else {
            statusPill.textContent = 'Timer status: Real';
            statusPill.className = 'status-pill';
          }
        }

        // Update confidence
        if (confidencePill) {
          const confidence = (timerData.confidence || 'medium').charAt(0).toUpperCase() + 
                            (timerData.confidence || 'medium').slice(1);
          confidencePill.textContent = `Confidence: ${confidence}`;
          confidencePill.className = `confidence-pill ${timerData.confidence || 'medium'}`;
        }

        // Update reasons
        if (reasonList && timerData.reasons) {
          reasonList.innerHTML = '';
          timerData.reasons.forEach(reason => {
            const li = document.createElement('li');
            li.textContent = reason;
            reasonList.appendChild(li);
          });
        }
      }

      // Expose analyzeProduct globally for use from index.html
      window.analyzeProduct = analyzeProduct;
    </script>
  </body>
</html>

